<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="teal.slice">
<title>Introduction to teal.slice • teal.slice</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to teal.slice">
<meta property="og:description" content="teal.slice">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><link rel="stylesheet" href="../consent.css">
<script src="../consent.js" type="text/javascript" charset="utf-8"></script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">teal.slice</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.0.9009</small>

    <div style="width: 140px; margin-left: 0.5rem;"> <small class="nav-text text-muted me-auto">part of</small> <img src="https://github.com/insightsengineering/hex-stickers/blob/main/PNG/nest.png?raw=true" alt="NEST" style="height: 30px;"><a href="https://pharmaverse.org/" class="external-link"><img src="https://github.com/insightsengineering/hex-stickers/blob/main/PNG/pharmaverse.png?raw=true" alt="pharmaverse" style="height: 28px;"></a> </div>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item">
  <a class="nav-link" href="../articles/teal-slice.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/filter-panel-for-developers.html">Filter panel for developers</a>
    <a class="dropdown-item" href="../articles/teal-slice-classes.html">teal.slice classes</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
<!-- start dropdown for versions --> <li class="nav-item dropdown">
        <a href="#" class="nav-link dropdown-toggle"
          data-bs-toggle="dropdown" role="button"
          aria-expanded="false" aria-haspopup="true"
          id="dropdown-versions">Versions</a> <div class="dropdown-menu" aria-labelledby="dropdown-versions"> <a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/teal.slice/main">main</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/teal.slice/latest-tag">latest-tag</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/teal.slice/v0.3.0">v0.3.0</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/teal.slice/v0.2.0">v0.2.0</a> </div></li>
<!-- end dropdown for versions -->
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-reports">Reports</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-reports">
    <a class="dropdown-item" href="../coverage-report/">Coverage report</a>
    <a class="dropdown-item" href="../unit-test-report/">Unit test report</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/insightsengineering/teal.slice">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Introduction to teal.slice</h1>
                        <h4 data-toc-skip class="author">NEST Core Dev
Team</h4>
            
            <h4 data-toc-skip class="date">01/07/2022</h4>
      
      
      <div class="d-none name"><code>teal-slice.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The <code>teal.slice</code> package provides a <em>filter panel</em>
for <code>shiny</code> applications. <code>teal.slice</code> creates a
filter panel module that allows for interactive filtering of data stored
in <code>data.frame</code> and <code>MultiAssayExperiment</code>
objects. It also displays filtered and unfiltered observation
counts.</p>
</div>
<div class="section level2">
<h2 id="information-for-users-of-the-filter-panel-in-applications">Information for users of the filter panel in applications<a class="anchor" aria-label="anchor" href="#information-for-users-of-the-filter-panel-in-applications"></a>
</h2>
<p>The filter panel contains three panels:</p>
<ol style="list-style-type: decimal">
<li>The top panel displays the number of records (observations) that
remain after the filters have been applied. For relational data (where
<code>join_keys</code> is specified), the number of unique subjects
remaining in the filtered data set is also shown.</li>
<li>The middle panel displays the current active filters and allows the
user to change their state.</li>
<li>The bottom panel allows to add new filters on columns of the data
sets in the app.</li>
</ol>
<p>Note that multiple filters for the same data set are combined with
the <code>AND</code> operator and it is not possible to apply
hierarchical filters.</p>
<p>An example of the filter panel in use is shown in the image below.
The <code>iris</code> data set has the 50 <code>versicolor</code>
records removed, leaving 100 observations. The <code>mtcars</code> data
set has filtered out all records other than those with
<code>(gear = 3 or gear = 5) and (disp in [205, 295])</code>.</p>
<p><img src="images/teal-slice/filter-panel.png" width="60%"></p>
<p>Depending on the data type of the selected variable, different
filters are shown, for example date pickers, range sliders, checkbox
inputs.</p>
<p>For relational data (when <code>join_keys</code> are specified),
filters specified on a parent data set (i.e. <code>ADSL</code>) will
apply to all child data sets, whereas filters for a child data set can
only be specified on columns not found in that data set’s parent. For
general relational data the filter panel treats each data set
independently, irrespective of relationships between data sets.</p>
<p>The filter panel also supports filtering
<code>MultiAssayExperiment</code> objects, where filters can be applied
to the subject data, which is stored in the <code>colData</code> slot
and accessed with <code>colData(MAE)</code>, as well as to experiments,
which are stored in the <code>ExperimentList</code> slot and accessed
with <code>MAE[["experiment name"]]</code>.</p>
</div>
<div class="section level2">
<h2 id="information-for-r-developers-using-the-filter-panel">Information for R developers using the filter panel<a class="anchor" aria-label="anchor" href="#information-for-r-developers-using-the-filter-panel"></a>
</h2>
<p>The example app below shows how to embed the filter panel inside a
shiny application.</p>
<p>The filter panel is entirely contained within a
<code>FilteredData</code> object. <code>FilteredData</code> is an
<code>R6</code> class that stores data sets, tracks filter states,
constructs and applies filter calls, and can output filtered data. It
also contains <code>shiny</code> modules (both UI and server functions)
that make up the panel itself.</p>
<p>In a <code>teal</code> application the <code>FilteredData</code>
object (<code>datasets</code>) is created automatically by
<code>teal</code>’s <code>init</code> function and filter panel
components are automatically placed on the right hand side of the
page.</p>
<p>Note that this example uses <code><a href="https://rdrr.io/pkg/shiny/man/renderDataTable.html" class="external-link">shiny::dataTableOutput</a></code> and
<code><a href="https://rdrr.io/pkg/shiny/man/renderDataTable.html" class="external-link">shiny::renderDataTable</a></code>. This can lead to issues with
Bootstrap, especially version 4. We recommend using
<code><a href="https://rdrr.io/pkg/DT/man/dataTableOutput.html" class="external-link">DT::dataTableOutput</a></code> and <code><a href="https://rdrr.io/pkg/DT/man/dataTableOutput.html" class="external-link">DT::renderDataTable</a></code> if
possible. See the <code>shiny</code> and <code>DT</code> documentation
for more information.</p>
<p>To facilitate communication with <code>FilteredData</code>, we
provide the filter panel API. The example below uses the
<code>set_filter_state</code> function to set state and the state is
specified with <code>teal_slices</code> and <code>teal_slice</code>
functions. For details please see the <em>Filter panel for
developers</em> vignette.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">teal.slice</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Loading required package: shiny</span></span></code></pre>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://shiny.posit.co/" class="external-link">shiny</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># create a FilteredData object</span></span>
<span><span class="va">datasets</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/init_filtered_data.html">init_filtered_data</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    iris <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>dataset <span class="op">=</span> <span class="va">iris</span><span class="op">)</span>,</span>
<span>    mtcars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>dataset <span class="op">=</span> <span class="va">mtcars</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># setting initial state</span></span>
<span><span class="fu"><a href="../reference/filter_state_api.html">set_filter_state</a></span><span class="op">(</span></span>
<span>  datasets <span class="op">=</span> <span class="va">datasets</span>,</span>
<span>  filter <span class="op">=</span> <span class="fu"><a href="../reference/teal_slices.html">teal_slices</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/teal_slice.html">teal_slice</a></span><span class="op">(</span>dataname <span class="op">=</span> <span class="st">"iris"</span>, varname <span class="op">=</span> <span class="st">"Species"</span>, selected <span class="op">=</span> <span class="st">"virginica"</span>, keep_na <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="../reference/teal_slice.html">teal_slice</a></span><span class="op">(</span>dataname <span class="op">=</span> <span class="st">"mtcars"</span>, id <span class="op">=</span> <span class="st">"4 cyl"</span>, title <span class="op">=</span> <span class="st">"4 Cylinders"</span>, expr <span class="op">=</span> <span class="st">"cyl == 4"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="../reference/teal_slice.html">teal_slice</a></span><span class="op">(</span>dataname <span class="op">=</span> <span class="st">"mtcars"</span>, varname <span class="op">=</span> <span class="st">"mpg"</span>, selected <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">20.0</span>, <span class="fl">25.0</span><span class="op">)</span>, keep_na <span class="op">=</span> <span class="cn">FALSE</span>, keep_inf <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>,</span>
<span>    include_varnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>iris <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Species"</span>, <span class="st">"Sepal.Length"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    exclude_varnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>mtcars <span class="op">=</span> <span class="st">"cyl"</span><span class="op">)</span>,</span>
<span>    count_type <span class="op">=</span> <span class="st">"all"</span>,</span>
<span>    allow_add <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">app</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html" class="external-link">shinyApp</a></span><span class="op">(</span></span>
<span>  ui <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html" class="external-link">fluidPage</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html" class="external-link">fluidRow</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/column.html" class="external-link">column</a></span><span class="op">(</span></span>
<span>        width <span class="op">=</span> <span class="fl">9</span>,</span>
<span>        <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/tabsetPanel.html" class="external-link">tabsetPanel</a></span><span class="op">(</span></span>
<span>          <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/tabPanel.html" class="external-link">tabPanel</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"iris"</span>, <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderDataTable.html" class="external-link">dataTableOutput</a></span><span class="op">(</span><span class="st">"iris_table"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>          <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/tabPanel.html" class="external-link">tabPanel</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"mtcars"</span>, <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderDataTable.html" class="external-link">dataTableOutput</a></span><span class="op">(</span><span class="st">"mtcars_table"</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span>      <span class="op">)</span>,</span>
<span>      <span class="co"># ui for the filter panel</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/column.html" class="external-link">column</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">3</span>, <span class="va">datasets</span><span class="op">$</span><span class="fu">ui_filter_panel</span><span class="op">(</span><span class="st">"filter_panel"</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  server <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># this is the shiny server function for the filter panel and the datasets</span></span>
<span>    <span class="co"># object can now be used inside the application</span></span>
<span>    <span class="va">datasets</span><span class="op">$</span><span class="fu">srv_filter_panel</span><span class="op">(</span><span class="st">"filter_panel"</span><span class="op">)</span></span>
<span></span>
<span>    <span class="co"># get the filtered datasets and put them inside reactives for analysis</span></span>
<span>    <span class="va">iris_filtered_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/reactive.html" class="external-link">reactive</a></span><span class="op">(</span><span class="va">datasets</span><span class="op">$</span><span class="fu">get_data</span><span class="op">(</span>dataname <span class="op">=</span> <span class="st">"iris"</span>, filtered <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">mtcars_filtered_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/reactive.html" class="external-link">reactive</a></span><span class="op">(</span><span class="va">datasets</span><span class="op">$</span><span class="fu">get_data</span><span class="op">(</span>dataname <span class="op">=</span> <span class="st">"mtcars"</span>, filtered <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>    <span class="va">output</span><span class="op">$</span><span class="va">iris_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderDataTable.html" class="external-link">renderDataTable</a></span><span class="op">(</span><span class="fu">iris_filtered_data</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">output</span><span class="op">$</span><span class="va">mtcars_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderDataTable.html" class="external-link">renderDataTable</a></span><span class="op">(</span><span class="fu">mtcars_filtered_data</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">)</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/interactive.html" class="external-link">interactive</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/runApp.html" class="external-link">runApp</a></span><span class="op">(</span><span class="va">app</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="nest">
  <p>teal.slice is a part of the <strong>NEST</strong> and <a href="https://pharmaverse.org/" class="external-link"><strong>pharmaverse</strong></a>.</p>
</div>
<script type="text/javascript" src="../analytics.js"></script></footer>
</div>

  

  

  </body>
</html>
